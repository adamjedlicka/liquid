import { createMemo, lazy, Suspense } from 'solid-js'
import { Dynamic } from 'solid-js/web'
import { Provider, useLayout } from 'liquid-js/core/Layouts'

const layouts = {
  <%_ for (const layout of layouts) { _%>
  <%- layout.ident -%>: lazy(() => import('<%- layout.component -%>')),
  <%_ } _%>
}

const Layout = (props) => {
  const { layout } = useLayout()

  const children = createMemo(() => props.children)

  const component = createMemo(() => layouts[layout()])

  return <Dynamic component={component()}>{children()}</Dynamic>
}

export default (props) => {
  return (
    <Provider>
      <Suspense>
        <Layout>{props.children}</Layout>
      </Suspense>
    </Provider>
  )
}
